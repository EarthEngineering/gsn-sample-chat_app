{"fileName":"RelayRecipient.sol","contractName":"RelayRecipient","source":"pragma solidity ^0.5.5;\n\n// Contract that implements the relay recipient protocol.  Inherited by Gatekeeper, or any other relay recipient.\n//\n// The recipient contract is responsible to:\n// * pass a trusted IRelayHub singleton to the constructor.\n// * Implement acceptRelayedCall, which acts as a whitelist/blacklist of senders.  It is advised that the recipient's owner will be able to update that list to remove abusers.\n// * In every function that cares about the sender, use \"address sender = getSender()\" instead of msg.sender.  It'll return msg.sender for non-relayed transactions, or the real sender in case of relayed transactions.\n\nimport \"./IRelayRecipient.sol\";\nimport \"./IRelayHub.sol\";\nimport \"@0x/contracts-utils/contracts/src/LibBytes.sol\";\n\ncontract RelayRecipient is IRelayRecipient {\n\n    IRelayHub private relayHub; // The IRelayHub singleton which is allowed to call us\n\n    function getHubAddr() public view returns (address) {\n        return address(relayHub);\n    }\n\n    /**\n     * Initialize the RelayHub of this contract.\n     * Must be called at least once (e.g. from the constructor), so that the contract can accept relayed calls.\n     * For ownable contracts, there should be a method to update the RelayHub, in case a new hub is deployed (since\n     * the RelayHub itself is not upgradeable)\n     * Otherwise, the contract might be locked on a dead hub, with no relays.\n     */\n    function setRelayHub(IRelayHub _rhub) internal {\n        relayHub = _rhub;\n\n        //attempt a read method, just to validate the relay is a valid RelayHub contract.\n        getRecipientBalance();\n    }\n\n    function getRelayHub() internal view returns (IRelayHub) {\n        return relayHub;\n    }\n\n    /**\n     * return the balance of this contract.\n     * Note that this method will revert on configuration error (invalid relay address)\n     */\n    function getRecipientBalance() public view returns (uint) {\n        return getRelayHub().balanceOf(address(this));\n    }\n\n    function getSenderFromData(address origSender, bytes memory msgData) public view returns (address) {\n        address sender = origSender;\n        if (origSender == getHubAddr()) {\n            // At this point we know that the sender is a trusted IRelayHub, so we trust that the last bytes of msg.data are the verified sender address.\n            // extract sender address from the end of msg.data\n            sender = LibBytes.readAddress(msgData, msgData.length - 20);\n        }\n        return sender;\n    }\n\n    /**\n     * return the sender of this call.\n     * if the call came through the valid RelayHub, return the original sender.\n     * otherwise, return `msg.sender`\n     * should be used in the contract anywhere instead of msg.sender\n     */\n    function getSender() public view returns (address) {\n        return getSenderFromData(msg.sender, msg.data);\n    }\n\n    function getMessageData() public view returns (bytes memory) {\n        bytes memory origMsgData = msg.data;\n        if (msg.sender == getHubAddr()) {\n            // At this point we know that the sender is a trusted IRelayHub, so we trust that the last bytes of msg.data are the verified sender address.\n            // extract original message data from the start of msg.data\n            origMsgData = new bytes(msg.data.length - 20);\n            for (uint256 i = 0; i < origMsgData.length; i++)\n            {\n                origMsgData[i] = msg.data[i];\n            }\n        }\n        return origMsgData;\n    }\n}\n\n","sourcePath":"tabookey-gasless/contracts/RelayRecipient.sol","sourceMap":"","deployedSourceMap":"","abi":[{"constant":true,"inputs":[{"name":"origSender","type":"address"},{"name":"msgData","type":"bytes"}],"name":"getSenderFromData","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getSender","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getHubAddr","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"context","type":"bytes"}],"name":"preRelayedCall","outputs":[{"name":"","type":"bytes32"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"relay","type":"address"},{"name":"from","type":"address"},{"name":"encodedFunction","type":"bytes"},{"name":"transactionFee","type":"uint256"},{"name":"gasPrice","type":"uint256"},{"name":"gasLimit","type":"uint256"},{"name":"nonce","type":"uint256"},{"name":"approvalData","type":"bytes"},{"name":"maxPossibleCharge","type":"uint256"}],"name":"acceptRelayedCall","outputs":[{"name":"","type":"uint256"},{"name":"","type":"bytes"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getRecipientBalance","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"context","type":"bytes"},{"name":"success","type":"bool"},{"name":"actualCharge","type":"uint256"},{"name":"preRetVal","type":"bytes32"}],"name":"postRelayedCall","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"getMessageData","outputs":[{"name":"","type":"bytes"}],"payable":false,"stateMutability":"view","type":"function"}],"ast":{"absolutePath":"tabookey-gasless/contracts/RelayRecipient.sol","exportedSymbols":{"RelayRecipient":[1560]},"id":1561,"nodeType":"SourceUnit","nodes":[{"id":1408,"literals":["solidity","^","0.5",".5"],"nodeType":"PragmaDirective","src":"0:23:8"},{"absolutePath":"tabookey-gasless/contracts/IRelayRecipient.sol","file":"./IRelayRecipient.sol","id":1409,"nodeType":"ImportDirective","scope":1561,"sourceUnit":1407,"src":"641:31:8","symbolAliases":[],"unitAlias":""},{"absolutePath":"tabookey-gasless/contracts/IRelayHub.sol","file":"./IRelayHub.sol","id":1410,"nodeType":"ImportDirective","scope":1561,"sourceUnit":1351,"src":"673:25:8","symbolAliases":[],"unitAlias":""},{"absolutePath":"@0x/contracts-utils/contracts/src/LibBytes.sol","file":"@0x/contracts-utils/contracts/src/LibBytes.sol","id":1411,"nodeType":"ImportDirective","scope":1561,"sourceUnit":494,"src":"699:56:8","symbolAliases":[],"unitAlias":""},{"baseContracts":[{"arguments":null,"baseName":{"contractScope":null,"id":1412,"name":"IRelayRecipient","nodeType":"UserDefinedTypeName","referencedDeclaration":1406,"src":"784:15:8","typeDescriptions":{"typeIdentifier":"t_contract$_IRelayRecipient_$1406","typeString":"contract IRelayRecipient"}},"id":1413,"nodeType":"InheritanceSpecifier","src":"784:15:8"}],"contractDependencies":[1406],"contractKind":"contract","documentation":null,"fullyImplemented":false,"id":1560,"linearizedBaseContracts":[1560,1406],"name":"RelayRecipient","nodeType":"ContractDefinition","nodes":[{"constant":false,"id":1415,"name":"relayHub","nodeType":"VariableDeclaration","scope":1560,"src":"807:26:8","stateVariable":true,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_contract$_IRelayHub_$1350","typeString":"contract IRelayHub"},"typeName":{"contractScope":null,"id":1414,"name":"IRelayHub","nodeType":"UserDefinedTypeName","referencedDeclaration":1350,"src":"807:9:8","typeDescriptions":{"typeIdentifier":"t_contract$_IRelayHub_$1350","typeString":"contract IRelayHub"}},"value":null,"visibility":"private"},{"body":{"id":1424,"nodeType":"Block","src":"947:41:8","statements":[{"expression":{"argumentTypes":null,"arguments":[{"argumentTypes":null,"id":1421,"name":"relayHub","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1415,"src":"972:8:8","typeDescriptions":{"typeIdentifier":"t_contract$_IRelayHub_$1350","typeString":"contract IRelayHub"}}],"expression":{"argumentTypes":[{"typeIdentifier":"t_contract$_IRelayHub_$1350","typeString":"contract IRelayHub"}],"id":1420,"isConstant":false,"isLValue":false,"isPure":true,"lValueRequested":false,"nodeType":"ElementaryTypeNameExpression","src":"964:7:8","typeDescriptions":{"typeIdentifier":"t_type$_t_address_$","typeString":"type(address)"},"typeName":"address"},"id":1422,"isConstant":false,"isLValue":false,"isPure":false,"kind":"typeConversion","lValueRequested":false,"names":[],"nodeType":"FunctionCall","src":"964:17:8","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"}},"functionReturnParameters":1419,"id":1423,"nodeType":"Return","src":"957:24:8"}]},"documentation":null,"id":1425,"implemented":true,"kind":"function","modifiers":[],"name":"getHubAddr","nodeType":"FunctionDefinition","parameters":{"id":1416,"nodeType":"ParameterList","parameters":[],"src":"914:2:8"},"returnParameters":{"id":1419,"nodeType":"ParameterList","parameters":[{"constant":false,"id":1418,"name":"","nodeType":"VariableDeclaration","scope":1425,"src":"938:7:8","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"},"typeName":{"id":1417,"name":"address","nodeType":"ElementaryTypeName","src":"938:7:8","stateMutability":"nonpayable","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"}},"value":null,"visibility":"internal"}],"src":"937:9:8"},"scope":1560,"src":"895:93:8","stateMutability":"view","superFunction":1357,"visibility":"public"},{"body":{"id":1437,"nodeType":"Block","src":"1459:155:8","statements":[{"expression":{"argumentTypes":null,"id":1432,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftHandSide":{"argumentTypes":null,"id":1430,"name":"relayHub","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1415,"src":"1469:8:8","typeDescriptions":{"typeIdentifier":"t_contract$_IRelayHub_$1350","typeString":"contract IRelayHub"}},"nodeType":"Assignment","operator":"=","rightHandSide":{"argumentTypes":null,"id":1431,"name":"_rhub","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1427,"src":"1480:5:8","typeDescriptions":{"typeIdentifier":"t_contract$_IRelayHub_$1350","typeString":"contract IRelayHub"}},"src":"1469:16:8","typeDescriptions":{"typeIdentifier":"t_contract$_IRelayHub_$1350","typeString":"contract IRelayHub"}},"id":1433,"nodeType":"ExpressionStatement","src":"1469:16:8"},{"expression":{"argumentTypes":null,"arguments":[],"expression":{"argumentTypes":[],"id":1434,"name":"getRecipientBalance","nodeType":"Identifier","overloadedDeclarations":[1460],"referencedDeclaration":1460,"src":"1586:19:8","typeDescriptions":{"typeIdentifier":"t_function_internal_view$__$returns$_t_uint256_$","typeString":"function () view returns (uint256)"}},"id":1435,"isConstant":false,"isLValue":false,"isPure":false,"kind":"functionCall","lValueRequested":false,"names":[],"nodeType":"FunctionCall","src":"1586:21:8","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"id":1436,"nodeType":"ExpressionStatement","src":"1586:21:8"}]},"documentation":"Initialize the RelayHub of this contract.\nMust be called at least once (e.g. from the constructor), so that the contract can accept relayed calls.\nFor ownable contracts, there should be a method to update the RelayHub, in case a new hub is deployed (since\nthe RelayHub itself is not upgradeable)\nOtherwise, the contract might be locked on a dead hub, with no relays.","id":1438,"implemented":true,"kind":"function","modifiers":[],"name":"setRelayHub","nodeType":"FunctionDefinition","parameters":{"id":1428,"nodeType":"ParameterList","parameters":[{"constant":false,"id":1427,"name":"_rhub","nodeType":"VariableDeclaration","scope":1438,"src":"1433:15:8","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_contract$_IRelayHub_$1350","typeString":"contract IRelayHub"},"typeName":{"contractScope":null,"id":1426,"name":"IRelayHub","nodeType":"UserDefinedTypeName","referencedDeclaration":1350,"src":"1433:9:8","typeDescriptions":{"typeIdentifier":"t_contract$_IRelayHub_$1350","typeString":"contract IRelayHub"}},"value":null,"visibility":"internal"}],"src":"1432:17:8"},"returnParameters":{"id":1429,"nodeType":"ParameterList","parameters":[],"src":"1459:0:8"},"scope":1560,"src":"1412:202:8","stateMutability":"nonpayable","superFunction":null,"visibility":"internal"},{"body":{"id":1445,"nodeType":"Block","src":"1677:32:8","statements":[{"expression":{"argumentTypes":null,"id":1443,"name":"relayHub","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1415,"src":"1694:8:8","typeDescriptions":{"typeIdentifier":"t_contract$_IRelayHub_$1350","typeString":"contract IRelayHub"}},"functionReturnParameters":1442,"id":1444,"nodeType":"Return","src":"1687:15:8"}]},"documentation":null,"id":1446,"implemented":true,"kind":"function","modifiers":[],"name":"getRelayHub","nodeType":"FunctionDefinition","parameters":{"id":1439,"nodeType":"ParameterList","parameters":[],"src":"1640:2:8"},"returnParameters":{"id":1442,"nodeType":"ParameterList","parameters":[{"constant":false,"id":1441,"name":"","nodeType":"VariableDeclaration","scope":1446,"src":"1666:9:8","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_contract$_IRelayHub_$1350","typeString":"contract IRelayHub"},"typeName":{"contractScope":null,"id":1440,"name":"IRelayHub","nodeType":"UserDefinedTypeName","referencedDeclaration":1350,"src":"1666:9:8","typeDescriptions":{"typeIdentifier":"t_contract$_IRelayHub_$1350","typeString":"contract IRelayHub"}},"value":null,"visibility":"internal"}],"src":"1665:11:8"},"scope":1560,"src":"1620:89:8","stateMutability":"view","superFunction":null,"visibility":"internal"},{"body":{"id":1459,"nodeType":"Block","src":"1921:62:8","statements":[{"expression":{"argumentTypes":null,"arguments":[{"argumentTypes":null,"arguments":[{"argumentTypes":null,"id":1455,"name":"this","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1603,"src":"1970:4:8","typeDescriptions":{"typeIdentifier":"t_contract$_RelayRecipient_$1560","typeString":"contract RelayRecipient"}}],"expression":{"argumentTypes":[{"typeIdentifier":"t_contract$_RelayRecipient_$1560","typeString":"contract RelayRecipient"}],"id":1454,"isConstant":false,"isLValue":false,"isPure":true,"lValueRequested":false,"nodeType":"ElementaryTypeNameExpression","src":"1962:7:8","typeDescriptions":{"typeIdentifier":"t_type$_t_address_$","typeString":"type(address)"},"typeName":"address"},"id":1456,"isConstant":false,"isLValue":false,"isPure":false,"kind":"typeConversion","lValueRequested":false,"names":[],"nodeType":"FunctionCall","src":"1962:13:8","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"}}],"expression":{"argumentTypes":[{"typeIdentifier":"t_address","typeString":"address"}],"expression":{"argumentTypes":null,"arguments":[],"expression":{"argumentTypes":[],"id":1451,"name":"getRelayHub","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1446,"src":"1938:11:8","typeDescriptions":{"typeIdentifier":"t_function_internal_view$__$returns$_t_contract$_IRelayHub_$1350_$","typeString":"function () view returns (contract IRelayHub)"}},"id":1452,"isConstant":false,"isLValue":false,"isPure":false,"kind":"functionCall","lValueRequested":false,"names":[],"nodeType":"FunctionCall","src":"1938:13:8","typeDescriptions":{"typeIdentifier":"t_contract$_IRelayHub_$1350","typeString":"contract IRelayHub"}},"id":1453,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"memberName":"balanceOf","nodeType":"MemberAccess","referencedDeclaration":1201,"src":"1938:23:8","typeDescriptions":{"typeIdentifier":"t_function_external_view$_t_address_$returns$_t_uint256_$","typeString":"function (address) view external returns (uint256)"}},"id":1457,"isConstant":false,"isLValue":false,"isPure":false,"kind":"functionCall","lValueRequested":false,"names":[],"nodeType":"FunctionCall","src":"1938:38:8","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"functionReturnParameters":1450,"id":1458,"nodeType":"Return","src":"1931:45:8"}]},"documentation":"return the balance of this contract.\nNote that this method will revert on configuration error (invalid relay address)","id":1460,"implemented":true,"kind":"function","modifiers":[],"name":"getRecipientBalance","nodeType":"FunctionDefinition","parameters":{"id":1447,"nodeType":"ParameterList","parameters":[],"src":"1891:2:8"},"returnParameters":{"id":1450,"nodeType":"ParameterList","parameters":[{"constant":false,"id":1449,"name":"","nodeType":"VariableDeclaration","scope":1460,"src":"1915:4:8","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"},"typeName":{"id":1448,"name":"uint","nodeType":"ElementaryTypeName","src":"1915:4:8","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"value":null,"visibility":"internal"}],"src":"1914:6:8"},"scope":1560,"src":"1863:120:8","stateMutability":"view","superFunction":1362,"visibility":"public"},{"body":{"id":1492,"nodeType":"Block","src":"2088:409:8","statements":[{"assignments":[1470],"declarations":[{"constant":false,"id":1470,"name":"sender","nodeType":"VariableDeclaration","scope":1492,"src":"2098:14:8","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"},"typeName":{"id":1469,"name":"address","nodeType":"ElementaryTypeName","src":"2098:7:8","stateMutability":"nonpayable","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"}},"value":null,"visibility":"internal"}],"id":1472,"initialValue":{"argumentTypes":null,"id":1471,"name":"origSender","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1462,"src":"2115:10:8","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"}},"nodeType":"VariableDeclarationStatement","src":"2098:27:8"},{"condition":{"argumentTypes":null,"commonType":{"typeIdentifier":"t_address","typeString":"address"},"id":1476,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"argumentTypes":null,"id":1473,"name":"origSender","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1462,"src":"2139:10:8","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"}},"nodeType":"BinaryOperation","operator":"==","rightExpression":{"argumentTypes":null,"arguments":[],"expression":{"argumentTypes":[],"id":1474,"name":"getHubAddr","nodeType":"Identifier","overloadedDeclarations":[1425],"referencedDeclaration":1425,"src":"2153:10:8","typeDescriptions":{"typeIdentifier":"t_function_internal_view$__$returns$_t_address_$","typeString":"function () view returns (address)"}},"id":1475,"isConstant":false,"isLValue":false,"isPure":false,"kind":"functionCall","lValueRequested":false,"names":[],"nodeType":"FunctionCall","src":"2153:12:8","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"}},"src":"2139:26:8","typeDescriptions":{"typeIdentifier":"t_bool","typeString":"bool"}},"falseBody":null,"id":1489,"nodeType":"IfStatement","src":"2135:333:8","trueBody":{"id":1488,"nodeType":"Block","src":"2167:301:8","statements":[{"expression":{"argumentTypes":null,"id":1486,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftHandSide":{"argumentTypes":null,"id":1477,"name":"sender","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1470,"src":"2398:6:8","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"}},"nodeType":"Assignment","operator":"=","rightHandSide":{"argumentTypes":null,"arguments":[{"argumentTypes":null,"id":1480,"name":"msgData","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1464,"src":"2428:7:8","typeDescriptions":{"typeIdentifier":"t_bytes_memory_ptr","typeString":"bytes memory"}},{"argumentTypes":null,"commonType":{"typeIdentifier":"t_uint256","typeString":"uint256"},"id":1484,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"argumentTypes":null,"expression":{"argumentTypes":null,"id":1481,"name":"msgData","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1464,"src":"2437:7:8","typeDescriptions":{"typeIdentifier":"t_bytes_memory_ptr","typeString":"bytes memory"}},"id":1482,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"memberName":"length","nodeType":"MemberAccess","referencedDeclaration":null,"src":"2437:14:8","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"nodeType":"BinaryOperation","operator":"-","rightExpression":{"argumentTypes":null,"hexValue":"3230","id":1483,"isConstant":false,"isLValue":false,"isPure":true,"kind":"number","lValueRequested":false,"nodeType":"Literal","src":"2454:2:8","subdenomination":null,"typeDescriptions":{"typeIdentifier":"t_rational_20_by_1","typeString":"int_const 20"},"value":"20"},"src":"2437:19:8","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}}],"expression":{"argumentTypes":[{"typeIdentifier":"t_bytes_memory_ptr","typeString":"bytes memory"},{"typeIdentifier":"t_uint256","typeString":"uint256"}],"expression":{"argumentTypes":null,"id":1478,"name":"LibBytes","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":493,"src":"2407:8:8","typeDescriptions":{"typeIdentifier":"t_type$_t_contract$_LibBytes_$493_$","typeString":"type(library LibBytes)"}},"id":1479,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"memberName":"readAddress","nodeType":"MemberAccess","referencedDeclaration":246,"src":"2407:20:8","typeDescriptions":{"typeIdentifier":"t_function_internal_pure$_t_bytes_memory_ptr_$_t_uint256_$returns$_t_address_$","typeString":"function (bytes memory,uint256) pure returns (address)"}},"id":1485,"isConstant":false,"isLValue":false,"isPure":false,"kind":"functionCall","lValueRequested":false,"names":[],"nodeType":"FunctionCall","src":"2407:50:8","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"}},"src":"2398:59:8","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"}},"id":1487,"nodeType":"ExpressionStatement","src":"2398:59:8"}]}},{"expression":{"argumentTypes":null,"id":1490,"name":"sender","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1470,"src":"2484:6:8","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"}},"functionReturnParameters":1468,"id":1491,"nodeType":"Return","src":"2477:13:8"}]},"documentation":null,"id":1493,"implemented":true,"kind":"function","modifiers":[],"name":"getSenderFromData","nodeType":"FunctionDefinition","parameters":{"id":1465,"nodeType":"ParameterList","parameters":[{"constant":false,"id":1462,"name":"origSender","nodeType":"VariableDeclaration","scope":1493,"src":"2016:18:8","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"},"typeName":{"id":1461,"name":"address","nodeType":"ElementaryTypeName","src":"2016:7:8","stateMutability":"nonpayable","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"}},"value":null,"visibility":"internal"},{"constant":false,"id":1464,"name":"msgData","nodeType":"VariableDeclaration","scope":1493,"src":"2036:20:8","stateVariable":false,"storageLocation":"memory","typeDescriptions":{"typeIdentifier":"t_bytes_memory_ptr","typeString":"bytes"},"typeName":{"id":1463,"name":"bytes","nodeType":"ElementaryTypeName","src":"2036:5:8","typeDescriptions":{"typeIdentifier":"t_bytes_storage_ptr","typeString":"bytes"}},"value":null,"visibility":"internal"}],"src":"2015:42:8"},"returnParameters":{"id":1468,"nodeType":"ParameterList","parameters":[{"constant":false,"id":1467,"name":"","nodeType":"VariableDeclaration","scope":1493,"src":"2079:7:8","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"},"typeName":{"id":1466,"name":"address","nodeType":"ElementaryTypeName","src":"2079:7:8","stateMutability":"nonpayable","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"}},"value":null,"visibility":"internal"}],"src":"2078:9:8"},"scope":1560,"src":"1989:508:8","stateMutability":"view","superFunction":null,"visibility":"public"},{"body":{"id":1505,"nodeType":"Block","src":"2796:63:8","statements":[{"expression":{"argumentTypes":null,"arguments":[{"argumentTypes":null,"expression":{"argumentTypes":null,"id":1499,"name":"msg","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1575,"src":"2831:3:8","typeDescriptions":{"typeIdentifier":"t_magic_message","typeString":"msg"}},"id":1500,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"memberName":"sender","nodeType":"MemberAccess","referencedDeclaration":null,"src":"2831:10:8","typeDescriptions":{"typeIdentifier":"t_address_payable","typeString":"address payable"}},{"argumentTypes":null,"expression":{"argumentTypes":null,"id":1501,"name":"msg","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1575,"src":"2843:3:8","typeDescriptions":{"typeIdentifier":"t_magic_message","typeString":"msg"}},"id":1502,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"memberName":"data","nodeType":"MemberAccess","referencedDeclaration":null,"src":"2843:8:8","typeDescriptions":{"typeIdentifier":"t_bytes_calldata_ptr","typeString":"bytes calldata"}}],"expression":{"argumentTypes":[{"typeIdentifier":"t_address_payable","typeString":"address payable"},{"typeIdentifier":"t_bytes_calldata_ptr","typeString":"bytes calldata"}],"id":1498,"name":"getSenderFromData","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1493,"src":"2813:17:8","typeDescriptions":{"typeIdentifier":"t_function_internal_view$_t_address_$_t_bytes_memory_ptr_$returns$_t_address_$","typeString":"function (address,bytes memory) view returns (address)"}},"id":1503,"isConstant":false,"isLValue":false,"isPure":false,"kind":"functionCall","lValueRequested":false,"names":[],"nodeType":"FunctionCall","src":"2813:39:8","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"}},"functionReturnParameters":1497,"id":1504,"nodeType":"Return","src":"2806:46:8"}]},"documentation":"return the sender of this call.\nif the call came through the valid RelayHub, return the original sender.\notherwise, return `msg.sender`\nshould be used in the contract anywhere instead of msg.sender","id":1506,"implemented":true,"kind":"function","modifiers":[],"name":"getSender","nodeType":"FunctionDefinition","parameters":{"id":1494,"nodeType":"ParameterList","parameters":[],"src":"2763:2:8"},"returnParameters":{"id":1497,"nodeType":"ParameterList","parameters":[{"constant":false,"id":1496,"name":"","nodeType":"VariableDeclaration","scope":1506,"src":"2787:7:8","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"},"typeName":{"id":1495,"name":"address","nodeType":"ElementaryTypeName","src":"2787:7:8","stateMutability":"nonpayable","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"}},"value":null,"visibility":"internal"}],"src":"2786:9:8"},"scope":1560,"src":"2745:114:8","stateMutability":"view","superFunction":null,"visibility":"public"},{"body":{"id":1558,"nodeType":"Block","src":"2926:552:8","statements":[{"assignments":[1512],"declarations":[{"constant":false,"id":1512,"name":"origMsgData","nodeType":"VariableDeclaration","scope":1558,"src":"2936:24:8","stateVariable":false,"storageLocation":"memory","typeDescriptions":{"typeIdentifier":"t_bytes_memory_ptr","typeString":"bytes"},"typeName":{"id":1511,"name":"bytes","nodeType":"ElementaryTypeName","src":"2936:5:8","typeDescriptions":{"typeIdentifier":"t_bytes_storage_ptr","typeString":"bytes"}},"value":null,"visibility":"internal"}],"id":1515,"initialValue":{"argumentTypes":null,"expression":{"argumentTypes":null,"id":1513,"name":"msg","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1575,"src":"2963:3:8","typeDescriptions":{"typeIdentifier":"t_magic_message","typeString":"msg"}},"id":1514,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"memberName":"data","nodeType":"MemberAccess","referencedDeclaration":null,"src":"2963:8:8","typeDescriptions":{"typeIdentifier":"t_bytes_calldata_ptr","typeString":"bytes calldata"}},"nodeType":"VariableDeclarationStatement","src":"2936:35:8"},{"condition":{"argumentTypes":null,"commonType":{"typeIdentifier":"t_address","typeString":"address"},"id":1520,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"argumentTypes":null,"expression":{"argumentTypes":null,"id":1516,"name":"msg","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1575,"src":"2985:3:8","typeDescriptions":{"typeIdentifier":"t_magic_message","typeString":"msg"}},"id":1517,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"memberName":"sender","nodeType":"MemberAccess","referencedDeclaration":null,"src":"2985:10:8","typeDescriptions":{"typeIdentifier":"t_address_payable","typeString":"address payable"}},"nodeType":"BinaryOperation","operator":"==","rightExpression":{"argumentTypes":null,"arguments":[],"expression":{"argumentTypes":[],"id":1518,"name":"getHubAddr","nodeType":"Identifier","overloadedDeclarations":[1425],"referencedDeclaration":1425,"src":"2999:10:8","typeDescriptions":{"typeIdentifier":"t_function_internal_view$__$returns$_t_address_$","typeString":"function () view returns (address)"}},"id":1519,"isConstant":false,"isLValue":false,"isPure":false,"kind":"functionCall","lValueRequested":false,"names":[],"nodeType":"FunctionCall","src":"2999:12:8","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"}},"src":"2985:26:8","typeDescriptions":{"typeIdentifier":"t_bool","typeString":"bool"}},"falseBody":null,"id":1555,"nodeType":"IfStatement","src":"2981:463:8","trueBody":{"id":1554,"nodeType":"Block","src":"3013:431:8","statements":[{"expression":{"argumentTypes":null,"id":1530,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftHandSide":{"argumentTypes":null,"id":1521,"name":"origMsgData","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1512,"src":"3253:11:8","typeDescriptions":{"typeIdentifier":"t_bytes_memory_ptr","typeString":"bytes memory"}},"nodeType":"Assignment","operator":"=","rightHandSide":{"argumentTypes":null,"arguments":[{"argumentTypes":null,"commonType":{"typeIdentifier":"t_uint256","typeString":"uint256"},"id":1528,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"argumentTypes":null,"expression":{"argumentTypes":null,"expression":{"argumentTypes":null,"id":1524,"name":"msg","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1575,"src":"3277:3:8","typeDescriptions":{"typeIdentifier":"t_magic_message","typeString":"msg"}},"id":1525,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"memberName":"data","nodeType":"MemberAccess","referencedDeclaration":null,"src":"3277:8:8","typeDescriptions":{"typeIdentifier":"t_bytes_calldata_ptr","typeString":"bytes calldata"}},"id":1526,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"memberName":"length","nodeType":"MemberAccess","referencedDeclaration":null,"src":"3277:15:8","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"nodeType":"BinaryOperation","operator":"-","rightExpression":{"argumentTypes":null,"hexValue":"3230","id":1527,"isConstant":false,"isLValue":false,"isPure":true,"kind":"number","lValueRequested":false,"nodeType":"Literal","src":"3295:2:8","subdenomination":null,"typeDescriptions":{"typeIdentifier":"t_rational_20_by_1","typeString":"int_const 20"},"value":"20"},"src":"3277:20:8","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}}],"expression":{"argumentTypes":[{"typeIdentifier":"t_uint256","typeString":"uint256"}],"id":1523,"isConstant":false,"isLValue":false,"isPure":true,"lValueRequested":false,"nodeType":"NewExpression","src":"3267:9:8","typeDescriptions":{"typeIdentifier":"t_function_objectcreation_pure$_t_uint256_$returns$_t_bytes_memory_$","typeString":"function (uint256) pure returns (bytes memory)"},"typeName":{"id":1522,"name":"bytes","nodeType":"ElementaryTypeName","src":"3271:5:8","typeDescriptions":{"typeIdentifier":"t_bytes_storage_ptr","typeString":"bytes"}}},"id":1529,"isConstant":false,"isLValue":false,"isPure":false,"kind":"functionCall","lValueRequested":false,"names":[],"nodeType":"FunctionCall","src":"3267:31:8","typeDescriptions":{"typeIdentifier":"t_bytes_memory","typeString":"bytes memory"}},"src":"3253:45:8","typeDescriptions":{"typeIdentifier":"t_bytes_memory_ptr","typeString":"bytes memory"}},"id":1531,"nodeType":"ExpressionStatement","src":"3253:45:8"},{"body":{"id":1552,"nodeType":"Block","src":"3373:61:8","statements":[{"expression":{"argumentTypes":null,"id":1550,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftHandSide":{"argumentTypes":null,"baseExpression":{"argumentTypes":null,"id":1543,"name":"origMsgData","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1512,"src":"3391:11:8","typeDescriptions":{"typeIdentifier":"t_bytes_memory_ptr","typeString":"bytes memory"}},"id":1545,"indexExpression":{"argumentTypes":null,"id":1544,"name":"i","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1533,"src":"3403:1:8","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"isConstant":false,"isLValue":true,"isPure":false,"lValueRequested":true,"nodeType":"IndexAccess","src":"3391:14:8","typeDescriptions":{"typeIdentifier":"t_bytes1","typeString":"bytes1"}},"nodeType":"Assignment","operator":"=","rightHandSide":{"argumentTypes":null,"baseExpression":{"argumentTypes":null,"expression":{"argumentTypes":null,"id":1546,"name":"msg","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1575,"src":"3408:3:8","typeDescriptions":{"typeIdentifier":"t_magic_message","typeString":"msg"}},"id":1547,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"memberName":"data","nodeType":"MemberAccess","referencedDeclaration":null,"src":"3408:8:8","typeDescriptions":{"typeIdentifier":"t_bytes_calldata_ptr","typeString":"bytes calldata"}},"id":1549,"indexExpression":{"argumentTypes":null,"id":1548,"name":"i","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1533,"src":"3417:1:8","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"nodeType":"IndexAccess","src":"3408:11:8","typeDescriptions":{"typeIdentifier":"t_bytes1","typeString":"bytes1"}},"src":"3391:28:8","typeDescriptions":{"typeIdentifier":"t_bytes1","typeString":"bytes1"}},"id":1551,"nodeType":"ExpressionStatement","src":"3391:28:8"}]},"condition":{"argumentTypes":null,"commonType":{"typeIdentifier":"t_uint256","typeString":"uint256"},"id":1539,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"argumentTypes":null,"id":1536,"name":"i","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1533,"src":"3332:1:8","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"nodeType":"BinaryOperation","operator":"<","rightExpression":{"argumentTypes":null,"expression":{"argumentTypes":null,"id":1537,"name":"origMsgData","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1512,"src":"3336:11:8","typeDescriptions":{"typeIdentifier":"t_bytes_memory_ptr","typeString":"bytes memory"}},"id":1538,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"memberName":"length","nodeType":"MemberAccess","referencedDeclaration":null,"src":"3336:18:8","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"src":"3332:22:8","typeDescriptions":{"typeIdentifier":"t_bool","typeString":"bool"}},"id":1553,"initializationExpression":{"assignments":[1533],"declarations":[{"constant":false,"id":1533,"name":"i","nodeType":"VariableDeclaration","scope":1553,"src":"3317:9:8","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"},"typeName":{"id":1532,"name":"uint256","nodeType":"ElementaryTypeName","src":"3317:7:8","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"value":null,"visibility":"internal"}],"id":1535,"initialValue":{"argumentTypes":null,"hexValue":"30","id":1534,"isConstant":false,"isLValue":false,"isPure":true,"kind":"number","lValueRequested":false,"nodeType":"Literal","src":"3329:1:8","subdenomination":null,"typeDescriptions":{"typeIdentifier":"t_rational_0_by_1","typeString":"int_const 0"},"value":"0"},"nodeType":"VariableDeclarationStatement","src":"3317:13:8"},"loopExpression":{"expression":{"argumentTypes":null,"id":1541,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"nodeType":"UnaryOperation","operator":"++","prefix":false,"src":"3356:3:8","subExpression":{"argumentTypes":null,"id":1540,"name":"i","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1533,"src":"3356:1:8","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"id":1542,"nodeType":"ExpressionStatement","src":"3356:3:8"},"nodeType":"ForStatement","src":"3312:122:8"}]}},{"expression":{"argumentTypes":null,"id":1556,"name":"origMsgData","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1512,"src":"3460:11:8","typeDescriptions":{"typeIdentifier":"t_bytes_memory_ptr","typeString":"bytes memory"}},"functionReturnParameters":1510,"id":1557,"nodeType":"Return","src":"3453:18:8"}]},"documentation":null,"id":1559,"implemented":true,"kind":"function","modifiers":[],"name":"getMessageData","nodeType":"FunctionDefinition","parameters":{"id":1507,"nodeType":"ParameterList","parameters":[],"src":"2888:2:8"},"returnParameters":{"id":1510,"nodeType":"ParameterList","parameters":[{"constant":false,"id":1509,"name":"","nodeType":"VariableDeclaration","scope":1559,"src":"2912:12:8","stateVariable":false,"storageLocation":"memory","typeDescriptions":{"typeIdentifier":"t_bytes_memory_ptr","typeString":"bytes"},"typeName":{"id":1508,"name":"bytes","nodeType":"ElementaryTypeName","src":"2912:5:8","typeDescriptions":{"typeIdentifier":"t_bytes_storage_ptr","typeString":"bytes"}},"value":null,"visibility":"internal"}],"src":"2911:14:8"},"scope":1560,"src":"2865:613:8","stateMutability":"view","superFunction":null,"visibility":"public"}],"scope":1561,"src":"757:2723:8"}],"src":"0:3482:8"},"bytecode":"0x","deployedBytecode":"0x","compiler":{"name":"solc","version":"0.5.10+commit.5a6ea5b1.Emscripten.clang","optimizer":{},"evmVersion":"constantinople"}}
