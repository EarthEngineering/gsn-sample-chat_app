{"fileName":"RelayRecipient.sol","contractName":"RelayRecipient","source":"pragma solidity ^0.5.5;\n\n// Contract that implements the relay recipient protocol.  Inherited by Gatekeeper, or any other relay recipient.\n//\n// The recipient contract is responsible to:\n// * pass a trusted IRelayHub singleton to the constructor.\n// * Implement acceptRelayedCall, which acts as a whitelist/blacklist of senders.  It is advised that the recipient's owner will be able to update that list to remove abusers.\n// * In every function that cares about the sender, use \"address sender = getSender()\" instead of msg.sender.  It'll return msg.sender for non-relayed transactions, or the real sender in case of relayed transactions.\n\nimport \"./IRelayRecipient.sol\";\nimport \"./IRelayHub.sol\";\nimport \"@0x/contracts-utils/contracts/src/LibBytes.sol\";\n\ncontract RelayRecipient is IRelayRecipient {\n\n    IRelayHub private relayHub; // The IRelayHub singleton which is allowed to call us\n\n    function getHubAddr() public view returns (address) {\n        return address(relayHub);\n    }\n\n    /**\n     * Initialize the RelayHub of this contract.\n     * Must be called at least once (e.g. from the constructor), so that the contract can accept relayed calls.\n     * For ownable contracts, there should be a method to update the RelayHub, in case a new hub is deployed (since\n     * the RelayHub itself is not upgradeable)\n     * Otherwise, the contract might be locked on a dead hub, with no relays.\n     */\n    function setRelayHub(IRelayHub _rhub) internal {\n        relayHub = _rhub;\n\n        //attempt a read method, just to validate the relay is a valid RelayHub contract.\n        getRecipientBalance();\n    }\n\n    function getRelayHub() internal view returns (IRelayHub) {\n        return relayHub;\n    }\n\n    /**\n     * return the balance of this contract.\n     * Note that this method will revert on configuration error (invalid relay address)\n     */\n    function getRecipientBalance() public view returns (uint) {\n        return getRelayHub().balanceOf(address(this));\n    }\n\n    function getSenderFromData(address origSender, bytes memory msgData) public view returns (address) {\n        address sender = origSender;\n        if (origSender == getHubAddr()) {\n            // At this point we know that the sender is a trusted IRelayHub, so we trust that the last bytes of msg.data are the verified sender address.\n            // extract sender address from the end of msg.data\n            sender = LibBytes.readAddress(msgData, msgData.length - 20);\n        }\n        return sender;\n    }\n\n    /**\n     * return the sender of this call.\n     * if the call came through the valid RelayHub, return the original sender.\n     * otherwise, return `msg.sender`\n     * should be used in the contract anywhere instead of msg.sender\n     */\n    function getSender() public view returns (address) {\n        return getSenderFromData(msg.sender, msg.data);\n    }\n\n    function getMessageData() public view returns (bytes memory) {\n        bytes memory origMsgData = msg.data;\n        if (msg.sender == getHubAddr()) {\n            // At this point we know that the sender is a trusted IRelayHub, so we trust that the last bytes of msg.data are the verified sender address.\n            // extract original message data from the start of msg.data\n            origMsgData = new bytes(msg.data.length - 20);\n            for (uint256 i = 0; i < origMsgData.length; i++)\n            {\n                origMsgData[i] = msg.data[i];\n            }\n        }\n        return origMsgData;\n    }\n}\n\n","sourcePath":"tabookey-gasless/contracts/RelayRecipient.sol","sourceMap":"","deployedSourceMap":"","abi":[{"constant":true,"inputs":[{"name":"origSender","type":"address"},{"name":"msgData","type":"bytes"}],"name":"getSenderFromData","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getSender","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getHubAddr","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"context","type":"bytes"}],"name":"preRelayedCall","outputs":[{"name":"","type":"bytes32"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"relay","type":"address"},{"name":"from","type":"address"},{"name":"encodedFunction","type":"bytes"},{"name":"transactionFee","type":"uint256"},{"name":"gasPrice","type":"uint256"},{"name":"gasLimit","type":"uint256"},{"name":"nonce","type":"uint256"},{"name":"approvalData","type":"bytes"},{"name":"maxPossibleCharge","type":"uint256"}],"name":"acceptRelayedCall","outputs":[{"name":"","type":"uint256"},{"name":"","type":"bytes"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getRecipientBalance","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"context","type":"bytes"},{"name":"success","type":"bool"},{"name":"actualCharge","type":"uint256"},{"name":"preRetVal","type":"bytes32"}],"name":"postRelayedCall","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"getMessageData","outputs":[{"name":"","type":"bytes"}],"payable":false,"stateMutability":"view","type":"function"}],"ast":{"absolutePath":"tabookey-gasless/contracts/RelayRecipient.sol","exportedSymbols":{"RelayRecipient":[1489]},"id":1490,"nodeType":"SourceUnit","nodes":[{"id":1337,"literals":["solidity","^","0.5",".5"],"nodeType":"PragmaDirective","src":"0:23:7"},{"absolutePath":"tabookey-gasless/contracts/IRelayRecipient.sol","file":"./IRelayRecipient.sol","id":1338,"nodeType":"ImportDirective","scope":1490,"sourceUnit":1336,"src":"641:31:7","symbolAliases":[],"unitAlias":""},{"absolutePath":"tabookey-gasless/contracts/IRelayHub.sol","file":"./IRelayHub.sol","id":1339,"nodeType":"ImportDirective","scope":1490,"sourceUnit":1280,"src":"673:25:7","symbolAliases":[],"unitAlias":""},{"absolutePath":"@0x/contracts-utils/contracts/src/LibBytes.sol","file":"@0x/contracts-utils/contracts/src/LibBytes.sol","id":1340,"nodeType":"ImportDirective","scope":1490,"sourceUnit":494,"src":"699:56:7","symbolAliases":[],"unitAlias":""},{"baseContracts":[{"arguments":null,"baseName":{"contractScope":null,"id":1341,"name":"IRelayRecipient","nodeType":"UserDefinedTypeName","referencedDeclaration":1335,"src":"784:15:7","typeDescriptions":{"typeIdentifier":"t_contract$_IRelayRecipient_$1335","typeString":"contract IRelayRecipient"}},"id":1342,"nodeType":"InheritanceSpecifier","src":"784:15:7"}],"contractDependencies":[1335],"contractKind":"contract","documentation":null,"fullyImplemented":false,"id":1489,"linearizedBaseContracts":[1489,1335],"name":"RelayRecipient","nodeType":"ContractDefinition","nodes":[{"constant":false,"id":1344,"name":"relayHub","nodeType":"VariableDeclaration","scope":1489,"src":"807:26:7","stateVariable":true,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_contract$_IRelayHub_$1279","typeString":"contract IRelayHub"},"typeName":{"contractScope":null,"id":1343,"name":"IRelayHub","nodeType":"UserDefinedTypeName","referencedDeclaration":1279,"src":"807:9:7","typeDescriptions":{"typeIdentifier":"t_contract$_IRelayHub_$1279","typeString":"contract IRelayHub"}},"value":null,"visibility":"private"},{"body":{"id":1353,"nodeType":"Block","src":"947:41:7","statements":[{"expression":{"argumentTypes":null,"arguments":[{"argumentTypes":null,"id":1350,"name":"relayHub","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1344,"src":"972:8:7","typeDescriptions":{"typeIdentifier":"t_contract$_IRelayHub_$1279","typeString":"contract IRelayHub"}}],"expression":{"argumentTypes":[{"typeIdentifier":"t_contract$_IRelayHub_$1279","typeString":"contract IRelayHub"}],"id":1349,"isConstant":false,"isLValue":false,"isPure":true,"lValueRequested":false,"nodeType":"ElementaryTypeNameExpression","src":"964:7:7","typeDescriptions":{"typeIdentifier":"t_type$_t_address_$","typeString":"type(address)"},"typeName":"address"},"id":1351,"isConstant":false,"isLValue":false,"isPure":false,"kind":"typeConversion","lValueRequested":false,"names":[],"nodeType":"FunctionCall","src":"964:17:7","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"}},"functionReturnParameters":1348,"id":1352,"nodeType":"Return","src":"957:24:7"}]},"documentation":null,"id":1354,"implemented":true,"kind":"function","modifiers":[],"name":"getHubAddr","nodeType":"FunctionDefinition","parameters":{"id":1345,"nodeType":"ParameterList","parameters":[],"src":"914:2:7"},"returnParameters":{"id":1348,"nodeType":"ParameterList","parameters":[{"constant":false,"id":1347,"name":"","nodeType":"VariableDeclaration","scope":1354,"src":"938:7:7","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"},"typeName":{"id":1346,"name":"address","nodeType":"ElementaryTypeName","src":"938:7:7","stateMutability":"nonpayable","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"}},"value":null,"visibility":"internal"}],"src":"937:9:7"},"scope":1489,"src":"895:93:7","stateMutability":"view","superFunction":1286,"visibility":"public"},{"body":{"id":1366,"nodeType":"Block","src":"1459:155:7","statements":[{"expression":{"argumentTypes":null,"id":1361,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftHandSide":{"argumentTypes":null,"id":1359,"name":"relayHub","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1344,"src":"1469:8:7","typeDescriptions":{"typeIdentifier":"t_contract$_IRelayHub_$1279","typeString":"contract IRelayHub"}},"nodeType":"Assignment","operator":"=","rightHandSide":{"argumentTypes":null,"id":1360,"name":"_rhub","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1356,"src":"1480:5:7","typeDescriptions":{"typeIdentifier":"t_contract$_IRelayHub_$1279","typeString":"contract IRelayHub"}},"src":"1469:16:7","typeDescriptions":{"typeIdentifier":"t_contract$_IRelayHub_$1279","typeString":"contract IRelayHub"}},"id":1362,"nodeType":"ExpressionStatement","src":"1469:16:7"},{"expression":{"argumentTypes":null,"arguments":[],"expression":{"argumentTypes":[],"id":1363,"name":"getRecipientBalance","nodeType":"Identifier","overloadedDeclarations":[1389],"referencedDeclaration":1389,"src":"1586:19:7","typeDescriptions":{"typeIdentifier":"t_function_internal_view$__$returns$_t_uint256_$","typeString":"function () view returns (uint256)"}},"id":1364,"isConstant":false,"isLValue":false,"isPure":false,"kind":"functionCall","lValueRequested":false,"names":[],"nodeType":"FunctionCall","src":"1586:21:7","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"id":1365,"nodeType":"ExpressionStatement","src":"1586:21:7"}]},"documentation":"Initialize the RelayHub of this contract.\nMust be called at least once (e.g. from the constructor), so that the contract can accept relayed calls.\nFor ownable contracts, there should be a method to update the RelayHub, in case a new hub is deployed (since\nthe RelayHub itself is not upgradeable)\nOtherwise, the contract might be locked on a dead hub, with no relays.","id":1367,"implemented":true,"kind":"function","modifiers":[],"name":"setRelayHub","nodeType":"FunctionDefinition","parameters":{"id":1357,"nodeType":"ParameterList","parameters":[{"constant":false,"id":1356,"name":"_rhub","nodeType":"VariableDeclaration","scope":1367,"src":"1433:15:7","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_contract$_IRelayHub_$1279","typeString":"contract IRelayHub"},"typeName":{"contractScope":null,"id":1355,"name":"IRelayHub","nodeType":"UserDefinedTypeName","referencedDeclaration":1279,"src":"1433:9:7","typeDescriptions":{"typeIdentifier":"t_contract$_IRelayHub_$1279","typeString":"contract IRelayHub"}},"value":null,"visibility":"internal"}],"src":"1432:17:7"},"returnParameters":{"id":1358,"nodeType":"ParameterList","parameters":[],"src":"1459:0:7"},"scope":1489,"src":"1412:202:7","stateMutability":"nonpayable","superFunction":null,"visibility":"internal"},{"body":{"id":1374,"nodeType":"Block","src":"1677:32:7","statements":[{"expression":{"argumentTypes":null,"id":1372,"name":"relayHub","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1344,"src":"1694:8:7","typeDescriptions":{"typeIdentifier":"t_contract$_IRelayHub_$1279","typeString":"contract IRelayHub"}},"functionReturnParameters":1371,"id":1373,"nodeType":"Return","src":"1687:15:7"}]},"documentation":null,"id":1375,"implemented":true,"kind":"function","modifiers":[],"name":"getRelayHub","nodeType":"FunctionDefinition","parameters":{"id":1368,"nodeType":"ParameterList","parameters":[],"src":"1640:2:7"},"returnParameters":{"id":1371,"nodeType":"ParameterList","parameters":[{"constant":false,"id":1370,"name":"","nodeType":"VariableDeclaration","scope":1375,"src":"1666:9:7","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_contract$_IRelayHub_$1279","typeString":"contract IRelayHub"},"typeName":{"contractScope":null,"id":1369,"name":"IRelayHub","nodeType":"UserDefinedTypeName","referencedDeclaration":1279,"src":"1666:9:7","typeDescriptions":{"typeIdentifier":"t_contract$_IRelayHub_$1279","typeString":"contract IRelayHub"}},"value":null,"visibility":"internal"}],"src":"1665:11:7"},"scope":1489,"src":"1620:89:7","stateMutability":"view","superFunction":null,"visibility":"internal"},{"body":{"id":1388,"nodeType":"Block","src":"1921:62:7","statements":[{"expression":{"argumentTypes":null,"arguments":[{"argumentTypes":null,"arguments":[{"argumentTypes":null,"id":1384,"name":"this","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1582,"src":"1970:4:7","typeDescriptions":{"typeIdentifier":"t_contract$_RelayRecipient_$1489","typeString":"contract RelayRecipient"}}],"expression":{"argumentTypes":[{"typeIdentifier":"t_contract$_RelayRecipient_$1489","typeString":"contract RelayRecipient"}],"id":1383,"isConstant":false,"isLValue":false,"isPure":true,"lValueRequested":false,"nodeType":"ElementaryTypeNameExpression","src":"1962:7:7","typeDescriptions":{"typeIdentifier":"t_type$_t_address_$","typeString":"type(address)"},"typeName":"address"},"id":1385,"isConstant":false,"isLValue":false,"isPure":false,"kind":"typeConversion","lValueRequested":false,"names":[],"nodeType":"FunctionCall","src":"1962:13:7","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"}}],"expression":{"argumentTypes":[{"typeIdentifier":"t_address","typeString":"address"}],"expression":{"argumentTypes":null,"arguments":[],"expression":{"argumentTypes":[],"id":1380,"name":"getRelayHub","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1375,"src":"1938:11:7","typeDescriptions":{"typeIdentifier":"t_function_internal_view$__$returns$_t_contract$_IRelayHub_$1279_$","typeString":"function () view returns (contract IRelayHub)"}},"id":1381,"isConstant":false,"isLValue":false,"isPure":false,"kind":"functionCall","lValueRequested":false,"names":[],"nodeType":"FunctionCall","src":"1938:13:7","typeDescriptions":{"typeIdentifier":"t_contract$_IRelayHub_$1279","typeString":"contract IRelayHub"}},"id":1382,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"memberName":"balanceOf","nodeType":"MemberAccess","referencedDeclaration":1130,"src":"1938:23:7","typeDescriptions":{"typeIdentifier":"t_function_external_view$_t_address_$returns$_t_uint256_$","typeString":"function (address) view external returns (uint256)"}},"id":1386,"isConstant":false,"isLValue":false,"isPure":false,"kind":"functionCall","lValueRequested":false,"names":[],"nodeType":"FunctionCall","src":"1938:38:7","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"functionReturnParameters":1379,"id":1387,"nodeType":"Return","src":"1931:45:7"}]},"documentation":"return the balance of this contract.\nNote that this method will revert on configuration error (invalid relay address)","id":1389,"implemented":true,"kind":"function","modifiers":[],"name":"getRecipientBalance","nodeType":"FunctionDefinition","parameters":{"id":1376,"nodeType":"ParameterList","parameters":[],"src":"1891:2:7"},"returnParameters":{"id":1379,"nodeType":"ParameterList","parameters":[{"constant":false,"id":1378,"name":"","nodeType":"VariableDeclaration","scope":1389,"src":"1915:4:7","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"},"typeName":{"id":1377,"name":"uint","nodeType":"ElementaryTypeName","src":"1915:4:7","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"value":null,"visibility":"internal"}],"src":"1914:6:7"},"scope":1489,"src":"1863:120:7","stateMutability":"view","superFunction":1291,"visibility":"public"},{"body":{"id":1421,"nodeType":"Block","src":"2088:409:7","statements":[{"assignments":[1399],"declarations":[{"constant":false,"id":1399,"name":"sender","nodeType":"VariableDeclaration","scope":1421,"src":"2098:14:7","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"},"typeName":{"id":1398,"name":"address","nodeType":"ElementaryTypeName","src":"2098:7:7","stateMutability":"nonpayable","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"}},"value":null,"visibility":"internal"}],"id":1401,"initialValue":{"argumentTypes":null,"id":1400,"name":"origSender","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1391,"src":"2115:10:7","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"}},"nodeType":"VariableDeclarationStatement","src":"2098:27:7"},{"condition":{"argumentTypes":null,"commonType":{"typeIdentifier":"t_address","typeString":"address"},"id":1405,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"argumentTypes":null,"id":1402,"name":"origSender","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1391,"src":"2139:10:7","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"}},"nodeType":"BinaryOperation","operator":"==","rightExpression":{"argumentTypes":null,"arguments":[],"expression":{"argumentTypes":[],"id":1403,"name":"getHubAddr","nodeType":"Identifier","overloadedDeclarations":[1354],"referencedDeclaration":1354,"src":"2153:10:7","typeDescriptions":{"typeIdentifier":"t_function_internal_view$__$returns$_t_address_$","typeString":"function () view returns (address)"}},"id":1404,"isConstant":false,"isLValue":false,"isPure":false,"kind":"functionCall","lValueRequested":false,"names":[],"nodeType":"FunctionCall","src":"2153:12:7","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"}},"src":"2139:26:7","typeDescriptions":{"typeIdentifier":"t_bool","typeString":"bool"}},"falseBody":null,"id":1418,"nodeType":"IfStatement","src":"2135:333:7","trueBody":{"id":1417,"nodeType":"Block","src":"2167:301:7","statements":[{"expression":{"argumentTypes":null,"id":1415,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftHandSide":{"argumentTypes":null,"id":1406,"name":"sender","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1399,"src":"2398:6:7","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"}},"nodeType":"Assignment","operator":"=","rightHandSide":{"argumentTypes":null,"arguments":[{"argumentTypes":null,"id":1409,"name":"msgData","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1393,"src":"2428:7:7","typeDescriptions":{"typeIdentifier":"t_bytes_memory_ptr","typeString":"bytes memory"}},{"argumentTypes":null,"commonType":{"typeIdentifier":"t_uint256","typeString":"uint256"},"id":1413,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"argumentTypes":null,"expression":{"argumentTypes":null,"id":1410,"name":"msgData","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1393,"src":"2437:7:7","typeDescriptions":{"typeIdentifier":"t_bytes_memory_ptr","typeString":"bytes memory"}},"id":1411,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"memberName":"length","nodeType":"MemberAccess","referencedDeclaration":null,"src":"2437:14:7","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"nodeType":"BinaryOperation","operator":"-","rightExpression":{"argumentTypes":null,"hexValue":"3230","id":1412,"isConstant":false,"isLValue":false,"isPure":true,"kind":"number","lValueRequested":false,"nodeType":"Literal","src":"2454:2:7","subdenomination":null,"typeDescriptions":{"typeIdentifier":"t_rational_20_by_1","typeString":"int_const 20"},"value":"20"},"src":"2437:19:7","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}}],"expression":{"argumentTypes":[{"typeIdentifier":"t_bytes_memory_ptr","typeString":"bytes memory"},{"typeIdentifier":"t_uint256","typeString":"uint256"}],"expression":{"argumentTypes":null,"id":1407,"name":"LibBytes","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":493,"src":"2407:8:7","typeDescriptions":{"typeIdentifier":"t_type$_t_contract$_LibBytes_$493_$","typeString":"type(library LibBytes)"}},"id":1408,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"memberName":"readAddress","nodeType":"MemberAccess","referencedDeclaration":246,"src":"2407:20:7","typeDescriptions":{"typeIdentifier":"t_function_internal_pure$_t_bytes_memory_ptr_$_t_uint256_$returns$_t_address_$","typeString":"function (bytes memory,uint256) pure returns (address)"}},"id":1414,"isConstant":false,"isLValue":false,"isPure":false,"kind":"functionCall","lValueRequested":false,"names":[],"nodeType":"FunctionCall","src":"2407:50:7","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"}},"src":"2398:59:7","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"}},"id":1416,"nodeType":"ExpressionStatement","src":"2398:59:7"}]}},{"expression":{"argumentTypes":null,"id":1419,"name":"sender","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1399,"src":"2484:6:7","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"}},"functionReturnParameters":1397,"id":1420,"nodeType":"Return","src":"2477:13:7"}]},"documentation":null,"id":1422,"implemented":true,"kind":"function","modifiers":[],"name":"getSenderFromData","nodeType":"FunctionDefinition","parameters":{"id":1394,"nodeType":"ParameterList","parameters":[{"constant":false,"id":1391,"name":"origSender","nodeType":"VariableDeclaration","scope":1422,"src":"2016:18:7","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"},"typeName":{"id":1390,"name":"address","nodeType":"ElementaryTypeName","src":"2016:7:7","stateMutability":"nonpayable","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"}},"value":null,"visibility":"internal"},{"constant":false,"id":1393,"name":"msgData","nodeType":"VariableDeclaration","scope":1422,"src":"2036:20:7","stateVariable":false,"storageLocation":"memory","typeDescriptions":{"typeIdentifier":"t_bytes_memory_ptr","typeString":"bytes"},"typeName":{"id":1392,"name":"bytes","nodeType":"ElementaryTypeName","src":"2036:5:7","typeDescriptions":{"typeIdentifier":"t_bytes_storage_ptr","typeString":"bytes"}},"value":null,"visibility":"internal"}],"src":"2015:42:7"},"returnParameters":{"id":1397,"nodeType":"ParameterList","parameters":[{"constant":false,"id":1396,"name":"","nodeType":"VariableDeclaration","scope":1422,"src":"2079:7:7","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"},"typeName":{"id":1395,"name":"address","nodeType":"ElementaryTypeName","src":"2079:7:7","stateMutability":"nonpayable","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"}},"value":null,"visibility":"internal"}],"src":"2078:9:7"},"scope":1489,"src":"1989:508:7","stateMutability":"view","superFunction":null,"visibility":"public"},{"body":{"id":1434,"nodeType":"Block","src":"2796:63:7","statements":[{"expression":{"argumentTypes":null,"arguments":[{"argumentTypes":null,"expression":{"argumentTypes":null,"id":1428,"name":"msg","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1560,"src":"2831:3:7","typeDescriptions":{"typeIdentifier":"t_magic_message","typeString":"msg"}},"id":1429,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"memberName":"sender","nodeType":"MemberAccess","referencedDeclaration":null,"src":"2831:10:7","typeDescriptions":{"typeIdentifier":"t_address_payable","typeString":"address payable"}},{"argumentTypes":null,"expression":{"argumentTypes":null,"id":1430,"name":"msg","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1560,"src":"2843:3:7","typeDescriptions":{"typeIdentifier":"t_magic_message","typeString":"msg"}},"id":1431,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"memberName":"data","nodeType":"MemberAccess","referencedDeclaration":null,"src":"2843:8:7","typeDescriptions":{"typeIdentifier":"t_bytes_calldata_ptr","typeString":"bytes calldata"}}],"expression":{"argumentTypes":[{"typeIdentifier":"t_address_payable","typeString":"address payable"},{"typeIdentifier":"t_bytes_calldata_ptr","typeString":"bytes calldata"}],"id":1427,"name":"getSenderFromData","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1422,"src":"2813:17:7","typeDescriptions":{"typeIdentifier":"t_function_internal_view$_t_address_$_t_bytes_memory_ptr_$returns$_t_address_$","typeString":"function (address,bytes memory) view returns (address)"}},"id":1432,"isConstant":false,"isLValue":false,"isPure":false,"kind":"functionCall","lValueRequested":false,"names":[],"nodeType":"FunctionCall","src":"2813:39:7","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"}},"functionReturnParameters":1426,"id":1433,"nodeType":"Return","src":"2806:46:7"}]},"documentation":"return the sender of this call.\nif the call came through the valid RelayHub, return the original sender.\notherwise, return `msg.sender`\nshould be used in the contract anywhere instead of msg.sender","id":1435,"implemented":true,"kind":"function","modifiers":[],"name":"getSender","nodeType":"FunctionDefinition","parameters":{"id":1423,"nodeType":"ParameterList","parameters":[],"src":"2763:2:7"},"returnParameters":{"id":1426,"nodeType":"ParameterList","parameters":[{"constant":false,"id":1425,"name":"","nodeType":"VariableDeclaration","scope":1435,"src":"2787:7:7","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"},"typeName":{"id":1424,"name":"address","nodeType":"ElementaryTypeName","src":"2787:7:7","stateMutability":"nonpayable","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"}},"value":null,"visibility":"internal"}],"src":"2786:9:7"},"scope":1489,"src":"2745:114:7","stateMutability":"view","superFunction":null,"visibility":"public"},{"body":{"id":1487,"nodeType":"Block","src":"2926:552:7","statements":[{"assignments":[1441],"declarations":[{"constant":false,"id":1441,"name":"origMsgData","nodeType":"VariableDeclaration","scope":1487,"src":"2936:24:7","stateVariable":false,"storageLocation":"memory","typeDescriptions":{"typeIdentifier":"t_bytes_memory_ptr","typeString":"bytes"},"typeName":{"id":1440,"name":"bytes","nodeType":"ElementaryTypeName","src":"2936:5:7","typeDescriptions":{"typeIdentifier":"t_bytes_storage_ptr","typeString":"bytes"}},"value":null,"visibility":"internal"}],"id":1444,"initialValue":{"argumentTypes":null,"expression":{"argumentTypes":null,"id":1442,"name":"msg","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1560,"src":"2963:3:7","typeDescriptions":{"typeIdentifier":"t_magic_message","typeString":"msg"}},"id":1443,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"memberName":"data","nodeType":"MemberAccess","referencedDeclaration":null,"src":"2963:8:7","typeDescriptions":{"typeIdentifier":"t_bytes_calldata_ptr","typeString":"bytes calldata"}},"nodeType":"VariableDeclarationStatement","src":"2936:35:7"},{"condition":{"argumentTypes":null,"commonType":{"typeIdentifier":"t_address","typeString":"address"},"id":1449,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"argumentTypes":null,"expression":{"argumentTypes":null,"id":1445,"name":"msg","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1560,"src":"2985:3:7","typeDescriptions":{"typeIdentifier":"t_magic_message","typeString":"msg"}},"id":1446,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"memberName":"sender","nodeType":"MemberAccess","referencedDeclaration":null,"src":"2985:10:7","typeDescriptions":{"typeIdentifier":"t_address_payable","typeString":"address payable"}},"nodeType":"BinaryOperation","operator":"==","rightExpression":{"argumentTypes":null,"arguments":[],"expression":{"argumentTypes":[],"id":1447,"name":"getHubAddr","nodeType":"Identifier","overloadedDeclarations":[1354],"referencedDeclaration":1354,"src":"2999:10:7","typeDescriptions":{"typeIdentifier":"t_function_internal_view$__$returns$_t_address_$","typeString":"function () view returns (address)"}},"id":1448,"isConstant":false,"isLValue":false,"isPure":false,"kind":"functionCall","lValueRequested":false,"names":[],"nodeType":"FunctionCall","src":"2999:12:7","typeDescriptions":{"typeIdentifier":"t_address","typeString":"address"}},"src":"2985:26:7","typeDescriptions":{"typeIdentifier":"t_bool","typeString":"bool"}},"falseBody":null,"id":1484,"nodeType":"IfStatement","src":"2981:463:7","trueBody":{"id":1483,"nodeType":"Block","src":"3013:431:7","statements":[{"expression":{"argumentTypes":null,"id":1459,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftHandSide":{"argumentTypes":null,"id":1450,"name":"origMsgData","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1441,"src":"3253:11:7","typeDescriptions":{"typeIdentifier":"t_bytes_memory_ptr","typeString":"bytes memory"}},"nodeType":"Assignment","operator":"=","rightHandSide":{"argumentTypes":null,"arguments":[{"argumentTypes":null,"commonType":{"typeIdentifier":"t_uint256","typeString":"uint256"},"id":1457,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"argumentTypes":null,"expression":{"argumentTypes":null,"expression":{"argumentTypes":null,"id":1453,"name":"msg","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1560,"src":"3277:3:7","typeDescriptions":{"typeIdentifier":"t_magic_message","typeString":"msg"}},"id":1454,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"memberName":"data","nodeType":"MemberAccess","referencedDeclaration":null,"src":"3277:8:7","typeDescriptions":{"typeIdentifier":"t_bytes_calldata_ptr","typeString":"bytes calldata"}},"id":1455,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"memberName":"length","nodeType":"MemberAccess","referencedDeclaration":null,"src":"3277:15:7","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"nodeType":"BinaryOperation","operator":"-","rightExpression":{"argumentTypes":null,"hexValue":"3230","id":1456,"isConstant":false,"isLValue":false,"isPure":true,"kind":"number","lValueRequested":false,"nodeType":"Literal","src":"3295:2:7","subdenomination":null,"typeDescriptions":{"typeIdentifier":"t_rational_20_by_1","typeString":"int_const 20"},"value":"20"},"src":"3277:20:7","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}}],"expression":{"argumentTypes":[{"typeIdentifier":"t_uint256","typeString":"uint256"}],"id":1452,"isConstant":false,"isLValue":false,"isPure":true,"lValueRequested":false,"nodeType":"NewExpression","src":"3267:9:7","typeDescriptions":{"typeIdentifier":"t_function_objectcreation_pure$_t_uint256_$returns$_t_bytes_memory_$","typeString":"function (uint256) pure returns (bytes memory)"},"typeName":{"id":1451,"name":"bytes","nodeType":"ElementaryTypeName","src":"3271:5:7","typeDescriptions":{"typeIdentifier":"t_bytes_storage_ptr","typeString":"bytes"}}},"id":1458,"isConstant":false,"isLValue":false,"isPure":false,"kind":"functionCall","lValueRequested":false,"names":[],"nodeType":"FunctionCall","src":"3267:31:7","typeDescriptions":{"typeIdentifier":"t_bytes_memory","typeString":"bytes memory"}},"src":"3253:45:7","typeDescriptions":{"typeIdentifier":"t_bytes_memory_ptr","typeString":"bytes memory"}},"id":1460,"nodeType":"ExpressionStatement","src":"3253:45:7"},{"body":{"id":1481,"nodeType":"Block","src":"3373:61:7","statements":[{"expression":{"argumentTypes":null,"id":1479,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftHandSide":{"argumentTypes":null,"baseExpression":{"argumentTypes":null,"id":1472,"name":"origMsgData","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1441,"src":"3391:11:7","typeDescriptions":{"typeIdentifier":"t_bytes_memory_ptr","typeString":"bytes memory"}},"id":1474,"indexExpression":{"argumentTypes":null,"id":1473,"name":"i","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1462,"src":"3403:1:7","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"isConstant":false,"isLValue":true,"isPure":false,"lValueRequested":true,"nodeType":"IndexAccess","src":"3391:14:7","typeDescriptions":{"typeIdentifier":"t_bytes1","typeString":"bytes1"}},"nodeType":"Assignment","operator":"=","rightHandSide":{"argumentTypes":null,"baseExpression":{"argumentTypes":null,"expression":{"argumentTypes":null,"id":1475,"name":"msg","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1560,"src":"3408:3:7","typeDescriptions":{"typeIdentifier":"t_magic_message","typeString":"msg"}},"id":1476,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"memberName":"data","nodeType":"MemberAccess","referencedDeclaration":null,"src":"3408:8:7","typeDescriptions":{"typeIdentifier":"t_bytes_calldata_ptr","typeString":"bytes calldata"}},"id":1478,"indexExpression":{"argumentTypes":null,"id":1477,"name":"i","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1462,"src":"3417:1:7","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"nodeType":"IndexAccess","src":"3408:11:7","typeDescriptions":{"typeIdentifier":"t_bytes1","typeString":"bytes1"}},"src":"3391:28:7","typeDescriptions":{"typeIdentifier":"t_bytes1","typeString":"bytes1"}},"id":1480,"nodeType":"ExpressionStatement","src":"3391:28:7"}]},"condition":{"argumentTypes":null,"commonType":{"typeIdentifier":"t_uint256","typeString":"uint256"},"id":1468,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"leftExpression":{"argumentTypes":null,"id":1465,"name":"i","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1462,"src":"3332:1:7","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"nodeType":"BinaryOperation","operator":"<","rightExpression":{"argumentTypes":null,"expression":{"argumentTypes":null,"id":1466,"name":"origMsgData","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1441,"src":"3336:11:7","typeDescriptions":{"typeIdentifier":"t_bytes_memory_ptr","typeString":"bytes memory"}},"id":1467,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"memberName":"length","nodeType":"MemberAccess","referencedDeclaration":null,"src":"3336:18:7","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"src":"3332:22:7","typeDescriptions":{"typeIdentifier":"t_bool","typeString":"bool"}},"id":1482,"initializationExpression":{"assignments":[1462],"declarations":[{"constant":false,"id":1462,"name":"i","nodeType":"VariableDeclaration","scope":1482,"src":"3317:9:7","stateVariable":false,"storageLocation":"default","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"},"typeName":{"id":1461,"name":"uint256","nodeType":"ElementaryTypeName","src":"3317:7:7","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"value":null,"visibility":"internal"}],"id":1464,"initialValue":{"argumentTypes":null,"hexValue":"30","id":1463,"isConstant":false,"isLValue":false,"isPure":true,"kind":"number","lValueRequested":false,"nodeType":"Literal","src":"3329:1:7","subdenomination":null,"typeDescriptions":{"typeIdentifier":"t_rational_0_by_1","typeString":"int_const 0"},"value":"0"},"nodeType":"VariableDeclarationStatement","src":"3317:13:7"},"loopExpression":{"expression":{"argumentTypes":null,"id":1470,"isConstant":false,"isLValue":false,"isPure":false,"lValueRequested":false,"nodeType":"UnaryOperation","operator":"++","prefix":false,"src":"3356:3:7","subExpression":{"argumentTypes":null,"id":1469,"name":"i","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1462,"src":"3356:1:7","typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"typeDescriptions":{"typeIdentifier":"t_uint256","typeString":"uint256"}},"id":1471,"nodeType":"ExpressionStatement","src":"3356:3:7"},"nodeType":"ForStatement","src":"3312:122:7"}]}},{"expression":{"argumentTypes":null,"id":1485,"name":"origMsgData","nodeType":"Identifier","overloadedDeclarations":[],"referencedDeclaration":1441,"src":"3460:11:7","typeDescriptions":{"typeIdentifier":"t_bytes_memory_ptr","typeString":"bytes memory"}},"functionReturnParameters":1439,"id":1486,"nodeType":"Return","src":"3453:18:7"}]},"documentation":null,"id":1488,"implemented":true,"kind":"function","modifiers":[],"name":"getMessageData","nodeType":"FunctionDefinition","parameters":{"id":1436,"nodeType":"ParameterList","parameters":[],"src":"2888:2:7"},"returnParameters":{"id":1439,"nodeType":"ParameterList","parameters":[{"constant":false,"id":1438,"name":"","nodeType":"VariableDeclaration","scope":1488,"src":"2912:12:7","stateVariable":false,"storageLocation":"memory","typeDescriptions":{"typeIdentifier":"t_bytes_memory_ptr","typeString":"bytes"},"typeName":{"id":1437,"name":"bytes","nodeType":"ElementaryTypeName","src":"2912:5:7","typeDescriptions":{"typeIdentifier":"t_bytes_storage_ptr","typeString":"bytes"}},"value":null,"visibility":"internal"}],"src":"2911:14:7"},"scope":1489,"src":"2865:613:7","stateMutability":"view","superFunction":null,"visibility":"public"}],"scope":1490,"src":"757:2723:7"}],"src":"0:3482:7"},"bytecode":"0x","deployedBytecode":"0x","compiler":{"name":"solc","version":"0.5.10+commit.5a6ea5b1.Emscripten.clang","optimizer":{},"evmVersion":"constantinople"}}
